<div id='form'>
  <%= form_with(html: {:id => "form"}) do |form| %>

    <div class='form-group' style="margin: auto; padding: 15px">
      <%= form.select :salutation, ["Mr", "Mrs.", "Ms."], class: "form-control", size: '3', placeholder: "Mr."%>
    </div>

    <div class='row' style="margin: auto; padding: 15px">
      <div class='col'>
        <%= form.text_field :first_name, class: "form-control", placeholder: "First name"%>
      </div>
      <div class='col'>
        <%= form.text_field :middle_name, class: "form-control", placeholder: "Middle name" %>
      </div>
      <div class="col">
        <%= form.text_field :last_name, class: "form-control", placeholder: "Last name" %>
      </div>
    </div>

    <div class="form-group" style="margin: auto; padding: 10px">
      <%= form.label :birthday %>
      <%= form.date_select :birth_date, class: "form-control" %>
    </div>
    <div class="form-group" style="margin: auto; padding: 10px">
      <%= form.text_field :SSN, class: "form-control", placeholder: "SSN"  %>
    </div>
    <div class="form-group" style="margin: auto; padding: 10px">
      <%= form.text_area :comment, placeholder: "Comments?"  %>
    </div>

  <div class="address-title">
    <h4>Address</h4>
  </div>

  <%= form.fields_for :addresses do |addresses_form| %>

    <div class="form-group" style="margin: auto; padding: 10px">
      <%= addresses_form.text_field :street, placeholder: "Address" %>
    </div>
    <div class='row' style="margin: auto; padding: 15px">
      <div class='col'>
        <%= addresses_form.text_field :town, placeholder: "City"  %>
      </div>
      <div class='col'>
        <%= addresses_form.text_field :zip_code, placeholder: "Zip Code" %>
      </div>
      <div class='col'>
        <%= addresses_form.text_field :state, placeholder: "State" %>
      </div>
      <div class='col'>
        <%= addresses_form.country_select :country, placeholder: "Country"  %>
      </div>
    </div>


  <% end %>


    Email:
    <ul>
      <%= form.fields_for :emails do |emails_form| %>
        <li>
          <%= emails_form.label :email_address %>
          <%= emails_form.email_field :email_address %>
        </li>
          <%= emails_form.label :comment %>
          <%= emails_form.text_area :comment %>
        <li>
      <% end %>
    </ul>

    Phone Number:
    <ul>
      <%= form.fields_for :phone_numbers do |numbers_form| %>
        <li>
          <%= numbers_form.label :phone_number %>
          <%= numbers_form.telephone_field :phone_number %>
        </li>
          <%= numbers_form.label :comment %>
          <%= numbers_form.text_area :comment %>
        <li>
      <% end %>
    </ul>
    <%= form.submit 'Add Person', class: "btn btn-outline-success btn-lg" %>
  <% end %>
</div>

<div id="people-container">
</div>

<script type="text/javascript" charset="utf-8">
$(function() {
  $(document).ready(function() {
      $.get("api/v1/people", function(data) {
          let string = data.map(person => {
              return `
                  <div class="person-name-detail">
                    <div>
                      <h4>Name: ${person.first_name}</h4>
                    </div>
                    <div>
                      <h4> ${ person.middle_name}</h4>
                    </div>
                    <div>
                      <h4> ${person.last_name}</h4>
                    </div>
                      <a href='/people/${person.id}/edit'>Edit</a>
                      <button id=edit>Delete</button>
                  </div>`
          }).join(' ');
          $("#people-container").html(string);
      });
  });
});

/*
$("#form").on( "submit", function( event ) {
  console.log("hi")
  event.preventDefault();
    $.ajax(
    {
       url:'api/v1/people',
       type: 'POST',
       data: {person: {first_name: "Matthew"}}
       dataType: "json",
       contentType: false,
       encode: true,
      }).done(function (data) {
      console.log(data);
    });
})
*/
$( "#form" ).submit(function( event ) {
  console.log( "Handler for .submit() called." );
  var person = ($('form').serializeArray())
  console.log(person)
  event.preventDefault();
    var form = $(this);
    var actionUrl = form.attr('action');

    $.ajax({
        type: "POST",
        url: 'api/v1/people',
        dataType: 'json',
        data: person, // serializes the form's elements.
        success: function(data)
        {
          $('#people-container').html(data);
        }
    });
});
</script>
