<div id='form'>
  <%= form_with(html: {:id => "form"}) do |form| %>
    <%= form.label :salutation %>
    <%= form.select :salutation, ["Mr", "Mrs.", "Ms."] %>
    <%= form.label :first_name %>
    <%= form.text_field :first_name %>
    <%= form.label :middle_name %>
    <%= form.text_field :middle_name %>
    <%= form.label :last_name %>
    <%= form.text_field :last_name %>
    <%= form.label :birth_date %>
    <%= form.date_select :birth_date %>
    <%= form.label :SSN %>
    <%= form.text_field :SSN %>
    <%= form.label :comment %>
    <%= form.text_area :comment %>

    Address:
    <ul>
      <%= form.fields_for :addresses do |addresses_form| %>
        <li>
          <%= addresses_form.label :street %>
          <%= addresses_form.text_field :street %>
        </li>
          <%= addresses_form.label :town %>
          <%= addresses_form.text_field :town %>
        <li>
          <%= addresses_form.label :zip_code %>
          <%= addresses_form.text_field :zip_code %>
        </li>
          <%= addresses_form.label :state %>
          <%= addresses_form.text_field :state %>
        <li>
          <%= addresses_form.country_select :country %>
        </li>
      <% end %>
    </ul>

    Email:
    <ul>
      <%= form.fields_for :emails do |emails_form| %>
        <li>
          <%= emails_form.label :email_address %>
          <%= emails_form.email_field :email_address %>
        </li>
          <%= emails_form.label :comment %>
          <%= emails_form.text_area :comment %>
        <li>
      <% end %>
    </ul>

    Phone Number:
    <ul>
      <%= form.fields_for :phone_numbers do |numbers_form| %>
        <li>
          <%= numbers_form.label :phone_number %>
          <%= numbers_form.telephone_field :phone_number %>
        </li>
          <%= numbers_form.label :comment %>
          <%= numbers_form.text_area :comment %>
        <li>
      <% end %>
    </ul>
    <%= form.submit 'Add Person' %>
  <% end %>
</div>

<div id="people-container">
</div>

<script type="text/javascript" charset="utf-8">
$(function() {
  $(document).ready(function() {
      $.get("api/v1/people", function(data) {
          let string = data.map(person => {
              return `
                  <div class="person-name-detail">
                    <div>
                      <h4>Name: ${person.first_name}</h4>
                    </div>
                    <div>
                      <h4> ${ person.middle_name}</h4>
                    </div>
                    <div>
                      <h4> ${person.last_name}</h4>
                    </div>
                      <a href='/people/${person.id}/edit'>Edit</a>
                      <button id=edit>Delete</button>
                  </div>`
          }).join(' ');
          $("#people-container").html(string);
      });
  });
});

/*
$("#form").on( "submit", function( event ) {
  console.log("hi")
  event.preventDefault();
    $.ajax(
    {
       url:'api/v1/people',
       type: 'POST',
       data: {person: {first_name: "Matthew"}}
       dataType: "json",
       contentType: false,
       encode: true,
      }).done(function (data) {
      console.log(data);
    });
})
*/
$( "#form" ).submit(function( event ) {
  console.log( "Handler for .submit() called." );
  var person = ($('form').serializeArray())
  console.log(person)
  event.preventDefault();
    var form = $(this);
    var actionUrl = form.attr('action');

    $.ajax({
        type: "POST",
        url: 'api/v1/people',
        dataType: 'json',
        data: person, // serializes the form's elements.
        success: function(data)
        {
          $('#people-container').html(data);
        }
    });
});
</script>
